{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "find_plan_v2.schema.json",
  "title": "find_plan_v2",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema", "intent", "intent_hash", "find"],
  "properties": {
    "schema": {
      "type": "string",
      "const": "find_plan_v2",
      "description": "Document discriminator for a compiled find plan (v2)."
    },
    "intent": {
      "description": "The original intent document.",
      "$ref": "find_intent_v2.schema.json"
    },
    "intent_hash": {
      "type": "string",
      "pattern": "^sha256:[0-9a-f]{64}$",
      "description": "SHA256 hash of normalized intent JSON."
    },
    "find": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "root",
        "include_patterns",
        "exclude_patterns",
        "extensions",
        "type",
        "max_depth",
        "max_results",
        "format",
        "policy",
        "limits"
      ],
      "properties": {
        "root": {
          "type": "string",
          "minLength": 1,
          "description": "Root directory for the enumeration."
        },
        "include_patterns": {
          "type": "array",
          "description": "Name patterns to include. Each pattern declares its own semantics.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["kind", "value"],
            "properties": {
              "kind": {
                "type": "string",
                "enum": ["glob", "regex"],
                "description": "Pattern semantics. fd default is regex; `--glob` switches to glob."
              },
              "value": {
                "type": "string",
                "minLength": 1,
                "maxLength": 512,
                "description": "Pattern value."
              }
            }
          },
          "maxItems": 32
        },
        "exclude_patterns": {
          "type": "array",
          "description": "Path patterns to exclude. Each pattern declares its own semantics.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["kind", "value"],
            "properties": {
              "kind": {
                "type": "string",
                "enum": ["glob", "regex"],
                "description": "Exclude semantics. Glob excludes may also be passed directly to fd to reduce surface."
              },
              "value": {
                "type": "string",
                "minLength": 1,
                "maxLength": 512,
                "description": "Exclude pattern value."
              }
            }
          },
          "maxItems": 64
        },
        "extensions": {
          "type": "array",
          "description": "File extensions to include (no dot).",
          "items": { "type": "string", "minLength": 1, "maxLength": 32 },
          "maxItems": 32
        },
        "type": {
          "type": "string",
          "enum": ["file", "directory", "any"],
          "description": "Entry type filter."
        },
        "max_depth": {
          "type": ["integer", "null"],
          "minimum": 0,
          "maximum": 128,
          "description": "Maximum directory depth."
        },
        "max_results": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100000,
          "description": "Max results to emit after sorting."
        },
        "format": {
          "type": "string",
          "enum": ["auto", "human", "jsonl"],
          "description": "Output format."
        },
        "policy": {
          "type": "object",
          "additionalProperties": false,
          "required": ["hidden", "follow", "no_ignore"],
          "properties": {
            "hidden": { "type": "boolean", "default": false },
            "follow": { "type": "boolean", "default": false },
            "no_ignore": { "type": "boolean", "default": false }
          }
        },
        "limits": {
          "type": "object",
          "description": "Execution limits (fail closed if exceeded).",
          "additionalProperties": false,
          "required": ["max_pattern_length", "max_exclude_pattern_length"],
          "properties": {
            "max_pattern_length": {
              "type": "integer",
              "minimum": 1,
              "maximum": 4096,
              "description": "Maximum length for any include pattern."
            },
            "max_exclude_pattern_length": {
              "type": "integer",
              "minimum": 1,
              "maximum": 4096,
              "description": "Maximum length for any exclude pattern."
            }
          }
        }
      }
    }
  }
}

